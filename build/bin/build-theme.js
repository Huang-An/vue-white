const fs = require('fs');
const path = require('path');
const components = require('../config/components');

const BASE_PATH = path.resolve(__dirname, '../../theme');
const OUTPUT_PATH = path.resolve(BASE_PATH, 'src', 'index.scss');
// 免引入
const WHITE_LIST = [];
// 基础引入
const BASE_LIST = ['reset'];
// 需要引入
const IMPORT_LIST = BASE_LIST.concat(Object.keys(components));
// 文件是否存在
const fileExists = function (filePath) {
    try {
        return fs.statSync(filePath).isFile();
    } catch (err) {
        return false;
    }
};
// 输出内容
let indexContent = '// Automatically generated by \'./build/bin/build-theme.js\' \n';

IMPORT_LIST.forEach(name => {
    if (WHITE_LIST.indexOf(name) > -1) return;

    const fileName = `${name}.scss`;
    const filePath = path.resolve(BASE_PATH, 'src', fileName);

    // 如果文件存在才导入
    if (fileExists(filePath)) {
        indexContent += '@import "./' + fileName + '";\n';
    } else {
        console.log(BASE_PATH, '不存在', fileName, '文件');
    }
});

fs.writeFileSync(OUTPUT_PATH, indexContent);
console.log('[build entry] DONE:', OUTPUT_PATH);
